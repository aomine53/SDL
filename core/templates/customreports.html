{% extends "layouts/base.html" %}

{% block title %} Datatable {% endblock title %}

<!-- Specific CSS goes HERE  -->
{% block stylesheets %}
{% endblock stylesheets %}

{% block content %}
    {#    <div class="row m-0">#}
    {#        <div class="col" id="myDiv">#}
    {#        </div>#}
    {#        <div class="col ml-20" id="myForm" style="background-color: #fff3cd">#}
    {#        </div>#}
    {#    </div>#}
    <button id="3dview" onclick="View_3D()" class="btn btn-outline-danger">3D</button>
    <button id="2dview" onclick="View_2D()" class="btn btn-outline-danger">2D</button>
    <div class="row p-0">
        <div id='myDiv' style="width: 45vw;height: 80vh"></div>
        <div id='myform' style="width: 45vw;height: 80vh; margin-left:10px;background-color: #fff">
            <h5 style="color: black;display: inline"><strong> Status: </strong></h5><h5 id="status" style="color: green; display: inline"><strong>--</strong></h5>
        </div>
    </div>
{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
    <script>
        function updateTag(point) {
            var data_update = {
                x: [[point[20]]],
                y: [[point[21]]],
                z: [[point[22]]]
            }
            Plotly.restyle('myDiv', data_update, 4)
        }

        function loc() {
            $.ajax({
                method: "GET",
                url: 'api/data/atdata',
                success: function (data1) {
                    updateTag(data1.atdata)
                    document.getElementById('status').textContent = data1.message
                },
                error: function (error_data) {
                    console.log("error")
                    console.log(error_data)
                }
            })
        }

        setInterval(loc, 100)

        function View_2D() {
            var trace1 = {
                name: "AN0",
                x: [0],
                y: [0],
                type: 'scatter',
                marker: {
                    color: "#E8290B",
                    size: 15,
                    symbol: 'triangle-up'
                }
            };
            var trace2 = {
                name: "AN1",
                x: [2.99],
                y: [0],
                type: 'scatter',
                marker: {
                    color: "#E8290B",
                    size: 15,
                    symbol: 'triangle-up'
                }
            };
            var trace3 = {
                name: "AN2",
                x: [0.44],
                y: [3.88],
                type: 'scatter',
                marker: {
                    color: "#E8290B",
                    size: 15,
                    symbol: 'triangle-up'
                }
            };
            var trace4 = {
                name: "AN4",
                x: [2.42],
                y: [4.35],
                type: 'scatter',
                marker: {
                    color: "#E8290B",
                    size: 15,
                    symbol: 'triangle-up'
                }
            };
            var trace5 = {
                name: "TAG",
                x: [],
                y: [],
                type: 'scatter',
                marker: {
                    color: "#29B966",
                }
            };
            var trace6 = {
                x: [1.5, 1.5, 1.5],
                y: [1.25, 2.25, 3.25],
                type: 'scatter',
                mode: 'text',
                text: ['Station 1', 'Station 2', 'Station 3'],
                textfont: {
                    color: 'black',
                    size: 18,
                    family: 'Arial'
                }
            };
            var data = [trace1, trace2, trace3, trace4, trace5, trace6];
            var layout = {
                shapes: [
                    {
                        type: 'rect',
                        xref: 'paper',
                        yref: 'y',
                        x0: 0,
                        y0: 1,
                        x1: 1,
                        y1: 1.5,
                        fillcolor: '#000',
                        opacity: 0.2,
                        line: {
                            width: 0
                        }
                    },
                    {
                        type: 'rect',
                        xref: 'paper',
                        yref: 'y',
                        x0: 0,
                        y0: 2,
                        x1: 1,
                        y1: 2.5,
                        fillcolor: '#000',
                        opacity: 0.2,
                        line: {
                            width: 0
                        }
                    },
                    {
                        type: 'rect',
                        xref: 'paper',
                        yref: 'y',
                        x0: 0,
                        y0: 3,
                        x1: 1,
                        y1: 3.5,
                        fillcolor: '#000',
                        opacity: 0.2,
                        line: {
                            width: 0
                        }
                    },
                ],
                xaxis: {
                    showgrid: true,
                    zeroline: false,
                    showline: true,
                    mirror: 'ticks',
                    gridcolor: '#edeeef ',
                    gridwidth: 0.5,
                    zerolinecolor: '#969696',
                    zerolinewidth: 4,
                    linecolor: '#636363',
                    autotick: false,
                    ticks: 'outside',
                    tick0: 0,
                    dtick: 0.25,
                    ticklen: 4,
                    tickwidth: 1,
                    tickcolor: '#000'
                },
                yaxis: {
                    showgrid: true,
                    zeroline: false,
                    showline: true,
                    mirror: 'ticks',
                    gridcolor: '#edeeef',
                    gridwidth: 0.5,
                    zerolinecolor: '#969696',
                    zerolinewidth: 4,
                    linecolor: '#636363',
                    autotick: false,
                    ticks: 'outside',
                    tick0: 0,
                    dtick: 0.25,
                    ticklen: 4,
                    tickwidth: 1,
                    tickcolor: '#000',
                },

            };
            Plotly.newPlot('myDiv', data, layout);
        }

        View_2D()

        function View_3D() {
            var trace1 = {
                x: [0],
                y: [0],
                z: [0],
                name: "AN0",
                mode: 'markers',
                marker: {
                    color: '#E8290B',
                    size: 6,
                    symbol: 'diamond',
                    line: {
                        color: 'rgba(217, 217, 217, 0.14)',
                        width: 0.5
                    },
                    opacity: 0.8
                },
                type: 'scatter3d'
            };

            var trace2 = {
                x: [2.99],
                y: [0],
                z: [0],
                mode: 'markers',
                name: 'AN1',
                marker: {
                    color: '#E8290B',
                    size: 6,
                    symbol: 'diamond',
                    line: {
                        color: 'rgb(204, 204, 204)',
                        width: 1
                    },
                    opacity: 0.8
                },
                type: 'scatter3d'
            };
            var trace3 = {
                x: [0.44],
                y: [3.88],
                z: [0.0],
                mode: 'markers',
                name: 'AN2',
                marker: {
                    color: '#E8290B',
                    size: 6,
                    symbol: 'diamond',
                    line: {
                        color: 'rgb(204, 204, 204)',
                        width: 1
                    },
                    opacity: 0.8
                },
                type: 'scatter3d'
            };
            var trace4 = {
                x: [2.42],
                y: [4.35],
                z: [0],
                mode: 'markers',
                name: 'AN3',
                marker: {
                    color: '#E8290B',
                    size: 6,
                    symbol: 'diamond',
                    line: {
                        color: 'rgb(204, 204, 204)',
                        width: 1
                    },
                    opacity: 0.8
                },
                type: 'scatter3d'
            };
            var trace5 = {
                x: [],
                y: [],
                z: [],
                mode: 'markers',
                name: 'TAG',
                marker: {
                    color: '#29B966',
                    size: 6,
                    symbol: 'circle',
                    line: {
                        color: 'rgb(204, 204, 204)',
                        width: 1
                    },
                    opacity: 0.8
                },
                type: 'scatter3d'
            };
            var data = [trace1, trace2, trace3, trace4, trace5];
            var layout = {
                margin: {
                    l: 0,
                    r: 0,
                    b: 0,
                    t: 0
                }
            };
            Plotly.newPlot('myDiv', data, layout);
        }
    </script>
{% endblock javascripts %}
